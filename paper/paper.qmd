---
title: "Electricity Usage in Toronto’s Public Facilities: Analyzing the Impact of Building Size on Energy Consumption"
author: 
  - Irene Liu
thanks: "Code and data are available at: https://github.com/zilin1017/Toronto_annual_energy_consumption.git."
date: today
date-format: long
abstract: "This study examines the relationship between building size(GFA) and electricity consumption in Toronto's public facilities. Data from over 500 buildings, including schools,libraries, and hospitals, show a consistent positive correlation between GFA and eletricity usage. Larger facilities, particularly healthcare centers, demonstrate higher energy consumption per square meter. These results help inform efforts to improve energy management in Toronto’s public buildings."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

#install.packages("opendatatoronto")
#install.packages("tidyverse")
library(tidyverse)
library(palmerpenguins)
```


# Introduction

Public infrastructure, including schools, libraries, healthcare centers, and government offices, forms the backbone of urban services in any modern city. As Toronto continues to expand, managing electricity usage in public buildings becomes increasingly critical. Energy efficiency in public facilities not only reduces operational costs but also contributes to environmental goals, such as carbon reduction and climate change mitigation[@droege2018urban].

One of the primary determinants of electricity consumption is building size, commonly measured as Gross Floor Area (GFA). Larger buildings tend to consume more energy for lighting, heating, cooling, and equipment operations, but this relationship is influenced by other factors such as building type, operational hours, and energy management systems [@hong2016occupant]. As such, it is crucial for policymakers to understand how building size and other factors influence electricity consumption in Toronto’s public facilities [@li2009managing].

Several studies have shown that energy efficiency measures in public buildings can lead to significant reductions in electricity consumption. For example, retrofitting large government buildings or healthcare facilities with modern energy management systems can reduce energy use, while smaller buildings like libraries and schools often exhibit lower per-square-meter energy consumption [@scott2008impact].

This paper explores the relationship between Property GFA (m²) and electricity usage (kWh) in over 500 public facilities in Toronto. The study aims to identify patterns in electricity consumption and provide insights for optimizing energy use in Toronto's public sector.


# Data {#sec-data}

Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| label: fig-Area
#| fig-cap: Density Plot for Property Area in Toronto
#| echo: false

ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(alpha = 0.8) +
  scale_fill_manual(values = c("darkorange","purple","cyan4"),
                    guide = "none") +
  theme_minimal() +
  facet_wrap(~species, ncol = 1) +
  coord_flip()

### graph1 ##
# Load necessary libraries
library(readxl)
library(ggplot2)
library(tidyverse)

# Relative path, assuming the project root directory is the current working directory
annual_energy_consumption_data_2021 <- readxl::read_excel("~/Desktop/Toronto_annual_energy_consumption/data/raw_data/annual-energy-consumption-data-2021.xlsx", skip = 5)

# Select and mutate columns, assigning the result back to the original data
annual_energy_consumption_data_2021 <- annual_energy_consumption_data_2021 |>
  dplyr::select(`Property GFA - Self-Reported (m²)`, `Electricity Use - Grid Purchase (kWh)`,  `City`) |>
  dplyr::mutate(Area = `Property GFA - Self-Reported (m²)`,
                kWh = `Electricity Use - Grid Purchase (kWh)`,
                City = `City`)  # Ensure City is the correct column name without quotes


# 基于数据的分面调整，并移除不必要的元素
annual_energy_consumption_data_2021 %>%
  ggplot(aes(x = Area, y = kWh, color = City)) +
  geom_point(alpha = 0.5) + # 设置透明度以减少重叠的影响
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ City, scales = "free") + # 允许每个分面自由缩放，以适应各自的范围
  ggtitle("Electricity Usage vs Building Size by City") +
  xlab("Building Size (GFA in m²)") +
  ylab("Electricity Usage (kWh)") +
  theme_minimal() +
  theme(
    axis.text.y = element_blank(),  # 去掉y轴的数字
    axis.ticks.y = element_blank(),  # 去掉y轴的刻度
    axis.text.x = element_text(angle = 45, hjust = 1)
  )



###2##
# Load necessary libraries
library(readxl)
library(ggplot2)
library(dplyr)

# Read the data from Excel
annual_energy_consumption_data_2021 <- readxl::read_excel("~/Desktop/Toronto_annual_energy_consumption/data/raw_data/annual-energy-consumption-data-2021.xlsx", skip = 5)

# Reclassify 'Other' types into a single 'Other' category
annual_energy_consumption_data_2021 <- annual_energy_consumption_data_2021 %>%
  mutate(Property_Type = case_when(
    grepl("Other", `Primary Property Type - Self Selected`) ~ "Other",
    TRUE ~ `Primary Property Type - Self Selected`
  ))

# Plotting the data
ggplot(annual_energy_consumption_data_2021, aes(x = `Property GFA - Self-Reported (m²)`, y = `Electricity Use - Grid Purchase (kWh)`, color = Property_Type)) +
  geom_point(alpha = 0.5) + # Set transparency to avoid overlapping
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ Property_Type, scales = "free") + # Facet based on Property_Type
  ggtitle("Electricity Usage vs Building Size by Facility Type") +
  xlab("Building Size (GFA in m²)") +
  ylab("Electricity Usage (kWh)") +
  theme_minimal() +
  theme(
    axis.text.y = element_blank(), # Remove y-axis numbers
    axis.ticks.y = element_blank(), # Remove y-axis ticks
    axis.text.x = element_text(angle = 45, hjust = 1) # Rotate x-axis text
  )


##graph3##

# 使用柱状图展示不同建筑类型的总用电量
ggplot(annual_energy_consumption_data_2021, aes(x = Property_Type, y = `Electricity Use - Grid Purchase (kWh)`, fill = Property_Type)) +
  geom_bar(stat = "identity") +
  ggtitle("Total Electricity Usage by Property Type") +
  xlab("Property Type") +
  ylab("Total Electricity Usage (kWh)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, margin = margin(b = 45), size = 10),
    axis.text.y = element_blank(), # Remove y-axis numbers
    axis.ticks.y = element_blank(), # Remove y-axis ticks
    axis.text.x = element_text(angle = 65, hjust = 1, size=6),
    legend.key.size = unit(0.3, "cm"),
    legend.text = element_text(size = 5))

```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)


Talk way more about it. 

```{r}
#| label: none
#| fig-cap: Relationship between wing length and width
#| echo: false
#| message: false
#| warning: false

library(ggplot2)

analysis_data <- read.csv("/Users/liuzilin/Desktop/Toronto_annual_energy_consumption/data/analysis_data/analysis_data.csv")


analysis_data |>
  ggplot(aes(x=log_Area)) +
  geom_histogram(aes(y= ..density..,fill = "pink")) +
  geom_density() +
  ggtitle("Density Plot for Property Area in Toronto")
  
```


```{r}
#| label: second
#| fig-cap: Relationship between ...
#| echo: false
#| message: false
#| warning: false



# Filter out zero or negative values (if needed)

analysis_data <- analysis_data |> 
  dplyr::filter(kWh > 0)

# Plot the histogram and density
analysis_data |>
  ggplot(aes(x = kWh)) +
  geom_histogram(aes(y = ..density..), fill = "orange", binwidth = 250000) +  # Adjust bin width
  geom_density() +
  ggtitle("Density Plot for Electricity Use in Toronto") +
  theme_minimal()


```

# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false



```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]


```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2


```



\newpage


# References




