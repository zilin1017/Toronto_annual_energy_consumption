---
title: "Electricity Usage in Toronto’s Public Facilities: Analyzing the Impact of Building Size on Energy Consumption"
author: 
  - Irene Liu
thanks: "Code and data are available at: https://github.com/zilin1017/Toronto_annual_energy_consumption.git."
date: today
date-format: long
abstract: "This study examines the relationship between building size(m²) and electricity consumption(kWh) in Toronto's public facilities. Data from over 500 buildings, including schools,libraries, and hospitals, show a consistent positive correlation between GFA and eletricity usage. Larger facilities, particularly healthcare centers, demonstrate higher energy consumption per square meter. These results help inform efforts to improve energy management in Toronto’s public buildings."
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

##install the packages
# install.packages("opendatatoronto")
# install.packages("tidyverse")
# install.packages("knitr")

library(tidyverse)
library(knitr)
library(dplyr)
library(ggplot2)
library(readr)


```


# Introduction

Public infrastructure, including schools, libraries, healthcare centers, and government offices, forms the backbone of urban services in any modern city. As Toronto continues to expand, managing electricity usage in public buildings becomes increasingly critical. Energy efficiency in public facilities not only reduces operational costs but also contributes to environmental goals, such as carbon reduction and climate change mitigation[@droege2018urban].

One of the primary determinants of electricity consumption is building size, commonly measured as Gross Floor Area (GFA). Larger buildings tend to consume more energy for lighting, heating, cooling, and equipment operations, but this relationship is influenced by other factors such as building type, operational hours, and energy management systems [@hong2016occupant]. As such, it is crucial for policymakers to understand how building size and other factors influence electricity consumption in Toronto’s public facilities [@li2009managing].

Several studies have shown that energy efficiency measures in public buildings can lead to significant reductions in electricity consumption. For example, retrofitting large government buildings or healthcare facilities with modern energy management systems can reduce energy use, while smaller buildings like libraries and schools often exhibit lower per-square-meter energy consumption [@scott2008impact].

This paper explores the relationship between Property GFA (m²) and electricity usage (kWh) in over 500 public facilities in Toronto. The study aims to identify patterns in electricity consumption and provide insights for optimizing energy use in Toronto's public sector.


# Data {#sec-data}

## Raw data
The data used in this paper came from the OpenData Toronto portal through the library [@opendt]. Data were cleaned and analyzed using the open source statistical programming language R [@citeR]. The particular data set used to analyze the Consumption of Energy is the Annual Energy Consumption Data in 2021 [@2021datatoronto]. The following packages helped with the data analysis: tidyverse [@tidyverse], here [@here]), dplyr [@dplyr] and ggplot2 [@ggplot] was use for making graphics. All data analysis was conducted using R [@citeR].

The data used in this analysis comes from the City of Toronto's Open Data Portal[@opendt], specifically focusing on energy consumption across various property types in Toronto for the year 2021[@2021datatoronto]. The dataset consists of 1,802 unique entries, each representing a specific property in various regions of Toronto. For each property, the data captures critical metrics such as the building size, self-reported in gross floor area (GFA) in square meters (m²), and the total electricity consumption, measured in kilowatt-hours (kWh), purchased from the grid. No personal or property-specific information is included. The data was last updated on July 4, 2023, and helps understand energy usage trends across different building types in Toronto.

## Cleaned Data

The cleaning process focused on removing irrelevant or incomplete data to ensure the dataset was suitable for analyzing electricity consumption patterns in Toronto's public sector. Missing values(NA) were removed during the data cleaning process, particularly those related to electricity usage. And buildings that did not meet the size criteria (less than 30 square meters or greater than 2,500 square meters) were also filtered out.Additionally, variables irrelevant to the study’s focus were also omitted. Furthermore, the cleaned data retains only the key variables required for the analysis: property type, electricity use, floor area, and log-transformed area. This ensures that the final dataset is both accurate and relevant for understanding electricity consumption trends across different public facilities in Toronto.

A sample of the cleaned data can be seen in @tbl-1. The cleaned analysis dataset is loaded using the R programming language [@citeR]. The folder structure for this analysis is also inherited from Professor Rohan Alexander [@rohan]. Figures and tables are then generated using the knitr [@knitr] and tidyverse [@tidyverse] packages.

```{r}
#| label: tbl-1
#| tbl-cap: Sample of cleaned data
#| echo: false

analysis_data <- read.csv(here::here("data/analysis_data/analysis_data.csv"))

analysis_data_subset <- analysis_data[ c("Property_Type", "kWh", "Area", "log_Area")]

filtered_data <- analysis_data_subset|>
  filter(!is.na(kWh) & kWh != "NA") |>   
  distinct(Property_Type, .keep_all = TRUE) 

kable(
  head(filtered_data, 6), 
  col.names = c("Property Type", "Electricity Use (kWh)", "Area (m²)", "Log of Area (m²)"),
  align = c("l", "c", "c", "c","c")
)

```

## Data Analysis

```{r}
#| label: fig-Area
#| fig-cap: Density Plot for Property Area in Toronto
#| echo: false
#| message: false
#| warning: false


raw_data <- read_csv(here::here("data/raw_data/raw_data.csv"), skip=5)
analysis_data <- read.csv(here::here("data/analysis_data/analysis_data.csv"))

annual_energy_consumption_data_2021 <- raw_data |>
  dplyr::select(`Property GFA - Self-Reported (m²)`, `Electricity Use - Grid Purchase (kWh)`,  `City`)|>
  dplyr::mutate(Area = `Property GFA - Self-Reported (m²)`,
                kWh = `Electricity Use - Grid Purchase (kWh)`,
                City = `City`) 


annual_energy_consumption_data_2021 %>%
  ggplot(aes(x = Area, y = kWh, color = City)) +
  geom_point(alpha = 0.5) + 
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ City, scales = "free") + 
  ggtitle("Electricity Usage vs Building Size by City") +
  xlab("Building Size (GFA in m²)") +
  ylab("Electricity Usage (kWh)") +
  theme_minimal() +
  theme(
    axis.ticks.y = element_blank(),  
    axis.text.y = element_blank(),
    axis.text.x = element_text(angle = 45, hjust = 1, size=4.5),
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank()
  )

```


```{r}
#| label: fig-Property
#| fig-cap: Percentage Electricity Usage by Properties 
#| echo: false
#| message: false
#| warning: false

raw_data <- read_csv(here::here("data/raw_data/raw_data.csv"), skip=5)
analysis_data <- read.csv(here::here("data/analysis_data/analysis_data.csv"))

analysis_data <- analysis_data |>
  mutate(Property_Type = case_when(
    grepl("Other", `Property_Type`) ~ "Other",
    TRUE ~ `Property_Type`
  ))
kWh_count <- analysis_data |>
  group_by(Property_Type)|>
  summarise(kWh = n()) |>
  arrange(desc(kWh))

ggplot(kWh_count, aes(x = Property_Type, y = kWh, fill = Property_Type)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = paste0(round(kWh/sum(kWh) *100 , 1), "%")), vjust=0.2, size = 2) +
  ggtitle("Total Electricity Usage by Property Type") +
  xlab("Property Type") +
  ylab("Total Electricity Usage (kWh)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, margin = margin(b = 45), size = 8),
    axis.text.y = element_blank(), 
    axis.ticks.y = element_blank(), 
    axis.text.x = element_text(angle = 65, hjust = 1, size=6),
    legend.key.size = unit(0.3, "cm"),
    legend.text = element_text(size = 5),
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank()
    )

```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)


Talk way more about it. 

```{r}
#| label: none
#| fig-cap: Relationship between wing length and width
#| echo: false
#| message: false
#| warning: false


analysis_data |>
  ggplot(aes(x=log_Area)) +
  geom_histogram(aes(y= ..density..,fill = "pink")) +
  geom_density() +
  ggtitle("Density Plot for Property Area in Toronto") +
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank()
    )
  
```


```{r}
#| label: second
#| fig-cap: Relationship between ...
#| echo: false
#| message: false
#| warning: false


analysis_data <- analysis_data |> 
  dplyr::filter(kWh > 0)

analysis_data |>
  ggplot(aes(x = kWh)) +
  geom_histogram(aes(y = ..density..), fill = "orange", binwidth = 250000, alpha = 0.6) +  
  geom_density() +
  ggtitle("Density Plot for Electricity Use in Toronto") +
  theme_minimal()+
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank()
    )

```

# Results

Our results are summarized in @fig-modelresults.

```{r}
#| label: fig-modelresults
#| fig-cap: Regression of Electricity Use on Area
#| echo: false
#| message: false
#| warning: false


raw_data <- read.csv(here::here("data/raw_data/raw_data.csv"), skip=5)
analysis_data <- read.csv(here::here("data/analysis_data/analysis_data.csv"))


library(tidyverse)
library(knitr)
library(dplyr)
library(ggplot2)
library(readr)

annual_energy_consumption_data_2021 <- analysis_data |>
  mutate(log_Area = log(Area), log_kWh = log(kWh))

ggplot(annual_energy_consumption_data_2021, aes(x = log_Area, y = log_kWh)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE, formula = y ~ x, color = "blue") +
  ggtitle("Log-Log Regression of Electricity Use on Area") +
  xlab("Log of Area (m²)") +
  ylab("Log of Electricity Use (kWh)") +
  theme_minimal()
```



# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]


```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2


```



\newpage


# References




